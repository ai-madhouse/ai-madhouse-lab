## Edge cases
- Local development served from IPv6 loopback (`http://[::1]:<port>`) now resolves realtime websocket URL to `ws://[::1]:8787/ws` instead of same-origin `/ws`, preventing unauthorized upgrades caused by host-only auth cookies.
- Dashboard realtime status no longer flips to disconnected on a standalone websocket `error` event; disconnected state is now driven by `close`, which matches actual transport teardown and avoids transient false negatives.
- Notes history POST now accepts `null` for optional request fields (`note_id`, `target_event_id`, `payload_iv`, `payload_ciphertext`) and relies on existing semantic checks to enforce required values per event kind.
- This matches the UI payload shape, which serializes missing optional values as `null`.
- Realtime card metrics now refresh on a 5s client poll and on websocket open, so counts can lag briefly after abrupt disconnects until `last_seen_at` falls outside the stale window.
- `/api/realtime/health` is auth-protected and returns DB-backed counts only; it does not depend on `REALTIME_URL`, which avoids false "metrics unavailable" states when websocket proxying works but direct health URL config is missing.

## Risks / Follow-ups
- The notes-history change is schema-level only; persistence behavior is unchanged (`null` is still written for absent optional columns).
- If stricter notes-history API contracts are desired later, consider normalizing the client payload to omit optional keys instead of sending `null`.
- `REALTIME_STALE_SECONDS` is currently fixed at `120` in app-side counting; if realtime server heartbeat/prune intervals change, this value should be kept aligned.
